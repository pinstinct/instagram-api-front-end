<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>jQuery Ajax Test</title>
  <link rel="stylesheet" href="static/css/normalize.css">
  <link rel="stylesheet" href="static/css/sprites.min.css">
  <link rel="stylesheet" href="static/css/base.min.css">
  <link rel="stylesheet" href="static/css/common.min.css">
  <link rel="stylesheet" href="static/css/header.min.css">
  <link rel="stylesheet" href="static/css/post_list.min.css">

  <!-- Swiper-->
  <link rel="stylesheet" href="../bower_components/swiper/dist/css/swiper.min.css">
</head>
<body>
  <div id=wrap>
       <header class="main-header">
           <nav class="header-nav">
               <span class="nav-group nav-left">
                   <a href="" class="logo sprite-logo"></a>
               </span>
               <span class="nav-group nav-center">
                   <input type="text">
               </span>
               <span class="nav-group nav-right">
                   <a href="" class="btn-header-nav sprite-explore"></a>
                   <a href="" class="btn-header-nav sprite-activity"></a>
                   <a href="" class="btn-header-nav sprite-profile"></a>
               </span>
           </nav>
       </header>
       <div class="content-container">

       </div>

       <button id="load-post-list">Load PostList</button>
   </div>
    <script src="../bower_components/jquery/dist/jquery.min.js"></script>
    <script src="../bower_components/swiper/dist/js/swiper.jquery.min.js"></script>
    <script>
    $('#load-post-list').click(function(){
      loadPostList();
    })
    // loadPostList ajax 요청의 response data에 'next'값이 있으면 해당 값을 할당할 변수
    var next;

    // PostList GET 요청 API 함수
    function loadPostList() {
      // 첫 loadPostList API 요청 URL
      var url = 'http://localhost:8000/api/post/';

      // next 값이 있다면 요청 url은 해당 값을 사용
      if(next != undefined && next != null) {
        url = next;
      }
      console.log(url)
      $.ajax(url)
       .done(function(data) {
        // ajax 요청의 응답에서 next 값을 가져와 변수에 할당
         next = data.next;
        // 응답에 results를 results의 길이만큼 순회하며
         for(var i=0; i < data.results.length; i++) {
           // 매 loop마다 result[i]의 값을 curPost 변수에 할당
           var curPost = data.results[i];
           console.log(curPost.pk);

           // curPost 값을 사용해서 div.content-container에
           // jQuery의 append 메서드를 사용해 새 HTML 요소를 동적으로 생성
           $('.content-container').append('<div>' + curPost.pk + '</div>')
         }
       })
       .fail(function(data) {
         console.log('fail');
         console.log(data);
         $('.content-container').append('<div>Fail</div>')
       });
    }
    </script>
</body>
</html>
